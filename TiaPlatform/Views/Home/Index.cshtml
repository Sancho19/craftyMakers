@model IEnumerable<TiaPlatform.Models.Resource>
@{
    ViewData["Title"] = "Home Page";
    var searchTerm = Context.Request.Query["search"];
}

<style>
    body {
        background-color: #ffffff;
        font-family: 'Segoe UI', sans-serif;
    }

    .brand-logo {
        height: 200px;
        width: 200px;
        object-fit: contain;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .hero-fade {
        animation: fadeInUp 1.5s ease-out;
    }

    .hero-title {
        background: linear-gradient(90deg, #8b5d44, #c56a6a);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
    }

    .hero-section {
        background: #fffaf7;
        padding: 4rem 2rem;
        border-radius: 1.5rem;
        box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
        margin-bottom: 3rem;
    }

    .btn-outline-info {
        border-color: #c56a6a;
        color: #c56a6a;
    }

        .btn-outline-info:hover {
            background-color: #c56a6a;
            color: white;
        }

    .alert-coming-soon {
        background-color: #fff7f1;
        border: 1px dashed #d06e6e;
        color: #7b3f3f;
    }
</style>

<!-- Combined Logo and Hero Section -->
<section class="hero-section hero-fade w-100" style="margin-top: -1rem; padding: 0; background: #fffaf7;">
    <div class="container-fluid px-4 py-5">
        <div class="row align-items-center text-center text-lg-start">
            <!-- Logo Left -->
            <div class="col-lg-4 mb-4 mb-lg-0 d-flex justify-content-center">
                <img src="/images/CraftyMakersLogo.jpg"
                     alt="The Crafty Makers Logo"
                     class="brand-logo"
                     style="width: 230px; height: 230px;" />
            </div>

            <!-- Text Right -->
            <div class="col-lg-8">
                <h1 class="fs-2 hero-title mb-3">Crafted with Heart, Designed for You</h1>
                <p class="lead text-muted small">
                    Discover handmade elegance and curated resources that educate, inspire, and create impact—only at The Crafty Makers.
                </p>
                <a href="#resourcesSection" class="btn btn-outline-info mt-3 px-4 rounded-pill">
                    <i class="bi bi-book me-1"></i> Start Browsing
                </a>
            </div>
        </div>
    </div>
</section>




<!-- Coming Soon Note -->
<div class="container text-center mb-5">
    <div class="alert alert-coming-soon rounded-4 shadow-sm">
        <strong>Luyo Campana Embroidery & NCB Jewellery</strong> – Two exciting additions to <em>The Crafty Makers</em> brand!  
        <br class="d-none d-md-inline" />
        From embroidered mugs, accessories, pillowcases to homemade jewellery...  
        <strong>Launching Soon!</strong>
    </div>
</div>

<!-- Browse Header -->
<div class="text-center mb-4" id="resourcesSection">
    <h2 class="fw-bold mb-2">Browse Educational Resources</h2>
    <p class="text-muted">Beautifully designed, expertly curated content to elevate your learning journey.</p>
</div>

<!-- Search Bar -->
<div class="container mb-4">
    <form id="searchForm" class="d-flex justify-content-center">
        <input type="text" name="search" id="searchInput"
               class="form-control w-50 rounded-start-pill border-end-0"
               placeholder="Search by title..." />
        <button type="submit" class="btn btn-outline-primary rounded-end-pill border-start-0">
            <i class="bi bi-search"></i>
        </button>
    </form>
</div>

<!-- AJAX Resource Grid -->
<div id="resourceGrid">
    @await Html.PartialAsync("ResourceGrid", Model)
</div>


<!-- Toast Cart Alert -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100;">
    <div id="cartAlert" class="toast align-items-center border-0 fade" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
            <div class="toast-body">Item added to cart!</div>
            <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<!-- Modal Backdrop Blur -->
<div id="customBlurBackdrop" class="custom-blur-backdrop d-none"></div>

<!-- Details Modal -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 bg-transparent">
            <div class="modal-body p-0 border-0 bg-transparent" id="detailsContent">
                <!-- AJAX-loaded content -->
            </div>
        </div>
    </div>
</div>

@section Scripts {
        <script>
            $(document).on('click', '.view-details', function () {
                const id = $(this).data('id');

                $.get(`/Resource/GetDetailsModal`, { id }, function (data) {
                    $('#detailsContent').html(data);
                    $('#customBlurBackdrop').removeClass('d-none');

                    const modal = new bootstrap.Modal(document.getElementById('detailsModal'));
                    modal.show();
                });
            });

            $('#detailsModal').on('hidden.bs.modal', function () {
                $('#customBlurBackdrop').addClass('d-none');
            });

            $('#searchForm').submit(function (e) {
                e.preventDefault();
                const searchTerm = $('#searchInput').val();
                $.get("/Home/GetFilteredResources", { search: searchTerm }, function (data) {
                    $('#resourceGrid').html(data);
                });
            });

            $(document).on('click', '.add-to-cart', function () {
                const resourceId = $(this).data('id');
                $.post("/Cart/Add", { resourceId }, function (response) {
                    const toastEl = $('#cartAlert');
                    const toastBody = $('#cartAlert .toast-body');
                    toastBody.text(response.message);
                    toastEl.removeClass('bg-success bg-warning text-bg-success text-bg-warning');

                    if (response.success) {
                        toastEl.addClass('text-bg-success');
                    } else {
                        toastEl.addClass('text-bg-warning');
                    }

                    const toast = new bootstrap.Toast(toastEl[0]);
                    toast.show();

                    if (response.success) {
                        updateCartBadge();
                        const modal = bootstrap.Modal.getInstance(document.getElementById('detailsModal'));
                        modal.hide();
                        $('#customBlurBackdrop').addClass('d-none');
                    }
                }).fail(function () {
                    alert("Something went wrong. Try again.");
                });
            });

            function updateCartBadge() {
                $.get("/Cart/GetCartItemCount", function (data) {
                    const badge = $('#cartCount');
                    if (data.count > 0) {
                        badge.text(data.count).removeClass('d-none');
                    } else {
                        badge.addClass('d-none');
                    }
                });
            }

            $(document).ready(updateCartBadge);
        </script>
}
